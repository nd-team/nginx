server {
  listen 80;
  server_name ~^(?<subdomain>.+)\.issp\.bjike\.com$;
  access_log off;
  location / {
    set $node "-node";
    client_max_body_size    100m;
    resolver 169.254.169.250;
    proxy_pass http://$subdomain$node;
    proxy_set_header  Host  $host;
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
server {
  listen 8080;
  server_name ~^(?<subdomain>.+)\.issp\.bjike\.com$;
  access_log off;
  location / {
    set $cus "-consumer";
    client_max_body_size    100m;
    resolver 169.254.169.250;
    proxy_pass http://$subdomain$cus:8080;
    proxy_set_header  Host  $host;
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
server { 
  listen 80;
  server_name ~^(?<subdomain>.+)\.bjike\.com$;
  access_log off;
  location / {
    client_max_body_size    100m;
    resolver 169.254.169.250;
    proxy_pass http://$subdomain;
    proxy_set_header  Host  $host;
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
